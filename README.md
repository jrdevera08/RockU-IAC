# RockU-IAC — Terraform + Ansible + Jenkins Lab (Free Tier ready)

This repo contains a ready-to-clone lab for provisioning a single Free-Tier EC2 instance (Amazon Linux 2 `t2.micro`) using Terraform, configuring it with Ansible, and orchestrating deployments via Jenkins.

## Repo structure
```
RockU-IAC/
├── Jenkinsfile                   # Jenkins pipeline for deploy (uses Terraform + Ansible)
├── Jenkinsfile.destroy           # Optional Jenkins pipeline to destroy infra
├── terraform/
│   ├── backend.tf                # S3 backend config (edit before use)
│   ├── main.tf
│   ├── variables.tf
│   └── outputs.tf
└── ansible/
    ├── playbook.yml
    └── inventory.ini            # generated by Terraform
```

## What I added for you
- Free-Tier safe defaults: `t2.micro` instance, 8 GB root volume, Amazon Linux 2 AMI.
- Terraform S3 backend file (`terraform/backend.tf`) — **you must create the S3 bucket and DynamoDB table** described below before running.
- Two Jenkins pipelines:
  - `Jenkinsfile` — Deploy pipeline (init/apply + run Ansible).
  - `Jenkinsfile.destroy` — Explicit destroy pipeline (runs `terraform destroy`).
- README contains step-by-step Windows 11 + WSL notes and AWS safety tips.

## Before you run (important)
1. **Create an S3 bucket for Terraform remote state** (must be unique per AWS account/region):
   - Example bucket name: `jrdevera08-rocku-iac-tfstate-<random-suffix>`
   - Create a DynamoDB table for state locking (primary key: `LockID`, type `String`) named like `jrdevera08-rocku-iac-locks`.
   - Edit `terraform/backend.tf` and set `bucket` and `dynamodb_table` values appropriately.

2. Ensure AWS credentials are configured in WSL:
   ```bash
   aws configure
   ```

3. Generate an SSH key inside WSL and keep the key at `~/.ssh/id_rsa` (the repo defaults to that path):
   ```bash
   ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
   ```

4. Install required tools:
   - On Windows: Terraform (add to PATH) and Jenkins (or a Jenkins agent).
   - In WSL (Ubuntu): Ansible, AWS CLI, and optionally Terraform if you prefer running Terraform inside WSL.
   - Example WSL install:
     ```bash
     sudo apt update && sudo apt upgrade -y
     sudo apt install -y ansible unzip curl
     curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o awscliv2.zip
     unzip awscliv2.zip
     sudo ./aws/install
     ```

## Quick manual test (in WSL)
```bash
# from WSL shell
cd /mnt/c/path/to/RockU-IAC/terraform
terraform init
terraform apply -auto-approve

# generate inventory
terraform output -raw ansible_inventory > ../ansible/inventory.ini

cd ../ansible
ansible-playbook -i inventory.ini playbook.yml
```

## Jenkins usage
- Create a Pipeline job pointing to this repo.
- For Windows Jenkins running commands in WSL, prefix shell commands with `wsl ` (examples in README).
- Use `Jenkinsfile` for deploy. Use `Jenkinsfile.destroy` for an explicit destroy job.

## Cost control
- Use `t2.micro` only and 8GB root volume.
- Destroy resources when not in use:
  ```bash
  cd terraform
  terraform destroy -auto-approve
  ```

## Support
If you want, I can push this directly to your GitHub repo if you provide a temporary personal access token with repo permissions — otherwise, download the ZIP, extract locally, and push to `https://github.com/jrdevera08/RockU-IAC.git`.
